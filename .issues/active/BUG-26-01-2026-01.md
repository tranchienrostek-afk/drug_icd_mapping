Input: 

curl -X 'POST'
  'http://10.14.190.28:8000/api/v1/mapping/match'
  -H 'accept: application/json'
  -H 'Content-Type: application/json'
  -d '{
  "request_id": "string",
  "claims": [
    {
      "id": "1",
      "service_name": "MEDOVENT 30 10X10",
      "description": "string",
      "amount": 10000
    },
    {
      "id": "2",
      "service_name": "PANTOLOC 40MG TAKEDA 1X7",
      "description": "string",
      "amount": 10000
    },
    {
      "id": "3",
      "service_name": "ThÄƒm dÃ² chá»©c nÄƒng",
      "description": "string",
      "amount": 10000
    }
  ],
  "medicines": [
    {
      "id": "1",
      "service_name": "Ambroxol hydrochloride (Medovent 30mg)",
      "description": "NgÃ y uá»‘ng 2 viÃªn chia 2 láº§n, sÃ¡ng 1 viÃªn, tá»‘i 1 viÃªn (sau Äƒn)",
      "amount": 0
    },
    {
      "id": "2",
      "service_name": "Pantoprazole (dÆ°á»›i dáº¡ng Pantoprazole sodium sesquihydrate)(Pantoloc 40mg)",
      "description": "NgÃ y uá»‘ng 1 viÃªn (trÆ°á»›c Äƒn sÃ¡ng 30 phÃºt)",
      "amount": 0
    }
  ],
  "config": {
    "ai_model": "string"
  }
}'


Output:

{
  "request_id": "string",
  "status": "processed",
  "processing_timestamp": "2026-01-26T03:06:45.747241",
  "summary": {
    "total_claim_items": 3,
    "total_medicine_items": 2,
    "matched_items": 0,
    "unmatched_claims": 3,
    "unclaimed_purchases": 1,
    "need_manual_review": 0,
    "risk_level": "high"
  },
  "results": [],
  "anomalies": {
    "claim_without_purchase": [
      {
        "id": "1",
        "service": "MEDOVENT 30 10X10",
        "amount": 10000,
        "risk_flag": "high",
        "reason": "KhÃ´ng tÃ¬m tháº¥y thuá»‘c tÆ°Æ¡ng á»©ng trong danh sÃ¡ch mua"
      },
      {
        "id": "2",
        "service": "PANTOLOC 40MG TAKEDA 1X7",
        "amount": 10000,
        "risk_flag": "high",
        "reason": "KhÃ´ng tÃ¬m tháº¥y thuá»‘c tÆ°Æ¡ng á»©ng trong danh sÃ¡ch mua"
      },
      {
        "id": "3",
        "service": "ThÄƒm dÃ² chá»©c nÄƒng",
        "amount": 10000,
        "risk_flag": "high",
        "reason": "KhÃ´ng tÃ¬m tháº¥y thuá»‘c tÆ°Æ¡ng á»©ng trong danh sÃ¡ch mua"
      }
    ],
    "purchase_without_claim": [
      {
        "id": "2",
        "service": "Pantoprazole (dÆ°á»›i dáº¡ng Pantoprazole sodium sesquihydrate)(Pantoloc 40mg)",
        "amount": 0,
        "risk_flag": "low",
        "reason": "Thuá»‘c Ä‘Ã£ mua nhÆ°ng khÃ´ng yÃªu cáº§u bá»“i thÆ°á»ng"
      }
    ]
  },
  "audit_trail": {
    "normalization_applied": true,
    "fuzzy_matching": true,
    "drug_ontology_used": true,
    "amount_used_as_supporting_signal": true,
    "processing_time_ms": 2518.1
  }
}


ÄÃ¡nh giÃ¡:


MÃ¬nh Ä‘Ã¡nh giÃ¡ **cháº¥t lÆ°á»£ng káº¿t quáº£** nÃ y theo gÃ³c nhÃ¬n **ká»¹ thuáº­t + nghiá»‡p vá»¥ giÃ¡m Ä‘á»‹nh** nhÃ© (tháº³ng, khÃ´ng ná»‹nh ğŸ˜„).

---

## 1. Tá»•ng quan nhanh

**Káº¿t quáº£ hiá»‡n táº¡i: CHáº¤T LÆ¯á»¢NG TRUNG BÃŒNH â€“ THIÃŠN Vá»€ BÃO Äá»˜NG (OVER-FLAGGING)**
Há»‡ thá»‘ng Ä‘ang **an toÃ n (conservative)** nhÆ°ng **chÆ°a thÃ´ng minh** trong khÃ¢u Ä‘á»‘i sÃ¡nh.

* `risk_level: high` â†’ há»£p lÃ½ **vá» máº·t mÃ¡y mÃ³c**
* NhÆ°ng  **vá» máº·t nghiá»‡p vá»¥** : cÃ²n nhiá»u dáº¥u hiá»‡u *false positive*

---

## 2. Nhá»¯ng Ä‘iá»ƒm lÃ m tá»‘t ğŸ‘

### 2.1. Cáº¥u trÃºc káº¿t quáº£ ráº¥t rÃµ rÃ ng

* PhÃ¢n tÃ¡ch tá»‘t:
  * `summary`
  * `results`
  * `anomalies`
  * `audit_trail`
* Ráº¥t phÃ¹ há»£p Ä‘á»ƒ:
  * log
  * audit
  * explainability (giáº£i trÃ¬nh)

### 2.2. Audit trail minh báº¡ch

CÃ¡c cá» sau  **lÃ  Ä‘iá»ƒm cá»™ng lá»›n** :

```json
"normalization_applied": true,
"fuzzy_matching": true,
"drug_ontology_used": true,
"amount_used_as_supporting_signal": true
```

â†’ Cho tháº¥y há»‡ thá»‘ng  **khÃ´ng pháº£i so chuá»—i thÃ´** , mÃ  Ä‘Ã£ cá»‘ gáº¯ng xá»­ lÃ½ thÃ´ng minh.

### 2.3. PhÃ¡t hiá»‡n Ä‘Æ°á»£c hai chiá»u

* Claim khÃ´ng cÃ³ purchase
* Purchase khÃ´ng cÃ³ claim
  â†’ Ä‘Ãºng chuáº©n má»™t há»‡ thá»‘ng kiá»ƒm soÃ¡t gian láº­n/bá»“i thÆ°á»ng.

---

## 3. Váº¥n Ä‘á» nghiÃªm trá»ng âŒ (áº£nh hÆ°á»Ÿng trá»±c tiáº¿p Ä‘áº¿n cháº¥t lÆ°á»£ng)

### 3.1. `matched_items = 0` lÃ  dáº¥u hiá»‡u **Ä‘Ã¡ng bÃ¡o Ä‘á»™ng**

Trong dá»¯ liá»‡u cÃ³:

* Claim:
  `PANTOLOC 40MG TAKEDA 1X7`
* Purchase:
* `Pantoprazole ... (Pantoloc 40mg)`

ğŸ‘‰ **Con ngÆ°á»i nhÃ¬n lÃ  match ngay**
ğŸ‘‰ Há»‡ thá»‘ng láº¡i coi lÃ  **KHÃ”NG MATCH**

â›” Äiá»u nÃ y lÃ m **giáº£m máº¡nh Ä‘á»™ tin cáº­y**

---

### 3.2. Ontology + fuzzy matching chÆ°a â€œÄ‘á»§ sÃ¢uâ€

Hiá»‡n táº¡i há»‡ thá»‘ng  **cÃ³ dÃ¹ng** , nhÆ°ng  **chÆ°a khai thÃ¡c Ä‘Ãºng má»©c** :

| Váº¥n Ä‘á»                    | Biá»ƒu hiá»‡n                                   |
| ---------------------------- | --------------------------------------------- |
| ThÆ°Æ¡ng máº¡i vs hoáº¡t cháº¥t | Pantoloc â†” Pantoprazole khÃ´ng Ä‘Æ°á»£c gá»™p  |
| Quy cÃ¡ch Ä‘Ã³ng gÃ³i        | 1x7 vs khÃ´ng cÃ³ quy cÃ¡ch                   |
| Viáº¿t hoa â€“ viáº¿t thÆ°á»ng  | TAKEDA vs khÃ´ng quan trá»ng                  |
| Dá»‹ch vá»¥ y táº¿              | â€œThÄƒm dÃ² chá»©c nÄƒngâ€ khÃ´ng pháº£i thuá»‘c |

ğŸ‘‰ Káº¿t quáº£ lÃ  **over-flag** â†’ `risk_level: high` bá»‹ Ä‘áº©y lÃªn sai.

---

### 3.3. ÄÃ¡nh Ä‘á»“ng â€œkhÃ´ng matchâ€ = â€œrá»§i ro caoâ€

Ba má»¥c Ä‘á»u bá»‹:

```json
"risk_flag": "high"
```

NhÆ°ng thá»±c táº¿:

| Dá»‹ch vá»¥             | Rá»§i ro tháº­t                                        |
| --------------------- | ---------------------------------------------------- |
| MEDOVENT              | CÃ³ thá»ƒ cao                                         |
| PANTOLOC              | **Rá»§i ro tháº¥p â€“ ráº¥t cÃ³ kháº£ nÄƒng match** |
| ThÄƒm dÃ² chá»©c nÄƒng | **Sai loáº¡i Ä‘á»‘i tÆ°á»£ng (non-drug)**         |

â›” ChÆ°a cÃ³ **risk stratification thÃ´ng minh**

---

## 4. ÄÃ¡nh giÃ¡ theo thang Ä‘iá»ƒm (10)

| TiÃªu chÃ­              | Äiá»ƒm             |
| ----------------------- | ------------------ |
| Cáº¥u trÃºc dá»¯ liá»‡u    | 9                  |
| Minh báº¡ch / audit      | 9                  |
| Logic Ä‘á»‘i sÃ¡nh       | 4                  |
| Hiá»ƒu ngá»¯ nghÄ©a y táº¿ | 3                  |
| PhÃ¢n táº§ng rá»§i ro     | 4                  |
| **Tá»•ng thá»ƒ**    | **5.5 / 10** |

---

## 5. Khuyáº¿n nghá»‹ cáº£i thiá»‡n (ráº¥t quan trá»ng)

### 5.1. PhÃ¢n loáº¡i Ä‘á»‘i tÆ°á»£ng trÆ°á»›c khi match

```text
Drug
â†³ Medical service
â†³ Consumable
```

â†’ â€œThÄƒm dÃ² chá»©c nÄƒngâ€ **khÃ´ng nÃªn Ä‘i vÃ o pipeline thuá»‘c**

---

### 5.2. Matching theo táº§ng (multi-layer matching)

Thá»© tá»± nÃªn lÃ :

1. **Hoáº¡t cháº¥t (active ingredient)** â€“ máº¡nh nháº¥t
2. TÃªn thÆ°Æ¡ng máº¡i
3. HÃ m lÆ°á»£ng
4. Quy cÃ¡ch
5. GiÃ¡ (chá»‰ há»— trá»£)

Pantoloc â†” Pantoprazole **pháº£i match á»Ÿ táº§ng 1**

---

### 5.3. Äiá»u chá»‰nh risk logic

VÃ­ dá»¥:

```text
IF active_ingredient_match = true
AND dosage_match = true
â†’ risk = low
```

KhÃ´ng nÃªn:

```text
IF no_exact_string_match
â†’ risk = high
```

---

### 5.4. Bá»• sung tráº¡ng thÃ¡i â€œprobable matchâ€

Thay vÃ¬:

* matched
* unmatched

NÃªn cÃ³:

* `exact_match`
* `probable_match`
* `needs_review`

---

## 6. Káº¿t luáº­n ngáº¯n gá»n

> Há»‡ thá»‘ng  **cÃ³ ná»n táº£ng tá»‘t** , nhÆ°ng hiá»‡n táº¡i  **Ä‘ang quÃ¡ cá»©ng nháº¯c** .
> Náº¿u dÃ¹ng trong thá»±c táº¿, káº¿t quáº£ nÃ y sáº½ **lÃ m giÃ¡m Ä‘á»‹nh viÃªn má»‡t** vÃ¬ pháº£i sá»­a láº¡i ráº¥t nhiá»u.

Náº¿u báº¡n muá»‘n, mÃ¬nh cÃ³ thá»ƒ:

* ğŸ”§ Ä‘á» xuáº¥t **logic matching v2 (pseudo-code)**
* ğŸ§  thiáº¿t káº¿ **risk scoring chuáº©n báº£o hiá»ƒm**
* ğŸ§ª viáº¿t **test case y táº¿ thá»±c táº¿** Ä‘á»ƒ Ã©p há»‡ thá»‘ng â€œkhÃ´nâ€ hÆ¡n

Chá»‰ cáº§n nÃ³i: *â€œlÃ m tiáº¿p pháº§n â€¦â€*
