# BÃ¡o CÃ¡o BUG-013 (2026-01-08)

**NgÃ y:** 2026-01-08
**Loáº¡i:** Bug Report
**Má»©c Ä‘á»™:** High
**Tráº¡ng thÃ¡i:** In Progress (Partial Solution)

## ğŸ“Œ MÃ´ Táº£ Bug
BUG-013 bÃ¡o cÃ¡o ráº±ng web crawler quÃ¡ cháº­m vÃ  khÃ´ng tÃ¬m tháº¥y thÃ´ng tin thuá»‘c. Test vá»›i 5 thuá»‘c (Ludox, Berodual, Symbicort, Althax, Hightamine) Ä‘á»u tráº£ vá» `sdk: null`.

## ğŸ” Root Cause Analysis

### NguyÃªn NhÃ¢n 1: Headless Detection
- Website `ThuocBietDuoc` phÃ¡t hiá»‡n vÃ  cháº·n headless browser
- API tráº£ vá» 200 OK nhÆ°ng ná»™i dung trá»‘ng

### NguyÃªn NhÃ¢n 2: Internal Search Cháº­m
- Pháº£i navigate â†’ type â†’ wait â†’ click â†’ parse
- Tá»•ng thá»i gian: ~15-20s/thuá»‘c
- Selectors dá»… bá»‹ thay Ä‘á»•i khi website update

## âœ… Giáº£i PhÃ¡p ÄÃ£ Triá»ƒn Khai

### Fix 1: Anti-Detection (HOÃ€N THÃ€NH)
```python
# app/service/crawler/main.py
browser = await p.chromium.launch(
    headless=is_headless,
    args=[
        '--disable-blink-features=AutomationControlled',
        '--no-sandbox',
        '--disable-setuid-sandbox',
        '--disable-dev-shm-usage',
        '--disable-gpu'
    ]
)
```

**Káº¿t quáº£:** Crawler khÃ´ng cÃ²n bá»‹ cháº·n

### Fix 2: Google Search Strategy (PARTIAL)
**Ã tÆ°á»Ÿng:** Thay tháº¿ internal search báº±ng `site:thuocbietduoc.com.vn {drug_name}`

**Implementation:**
- âœ… Táº¡o `GoogleSearchService` class
- âœ… TÃ­ch há»£p vÃ o `scrape_drug_web_advanced`
- âœ… ThÃªm `direct_url` parameter Ä‘á»ƒ skip search phase

**Váº¥n Ä‘á» gáº·p pháº£i:**
- `googlesearch-python` library bá»‹ Google rate limit
- Test timeout sau 120s
- KhÃ´ng thá»ƒ validate vá»›i BUG-013 drugs

## âš ï¸ Tráº¡ng ThÃ¡i Hiá»‡n Táº¡i
- Infrastructure code: âœ… HoÃ n thÃ nh
- Testing: âŒ ChÆ°a thÃ nh cÃ´ng (rate limit)
- Production ready: â³ Äang chá» giáº£i phÃ¡p API

## ğŸ¯ Next Actions

### Option A: SerpAPI (Recommended)
- Chi phÃ­: $50/month
- Äá»™ tin cáº­y: Cao
- Timeline: 1-2 giá» implement

### Option B: URL Cache
- Chi phÃ­: $0
- Äá»™ tin cáº­y: Trung bÃ¬nh
- Timeline: 4-6 giá» build cache

### Option C: Continue Original Approach
- Tiáº¿p tá»¥c optimize selectors
- Cáº£i thiá»‡n retry logic
- Timeline: Unknown (phá»¥ thuá»™c website structure)

## ğŸ“‹ Files LiÃªn Quan
- Task: `.ai_planning/active_tasks/task_017_improve_search_efficiency.md`
- Bug Report: `.issues/active/BUG-013_error_search_web.md`
- Implementation: `app/service/crawler/google_search.py`
- Test Script: `scripts/test_bug_013.py`

---
**NgÆ°á»i bÃ¡o cÃ¡o:** AI Agent (Antigravity)
