# AI EXECUTION REPORT (BÁO CÁO THỰC THI)

**Task ID:** Task 012 (Analyze Scraper Stability - BUG-010 Lesson Learn)
**Thời gian:** 2026-01-07 16:05
**Trạng thái:** ✅ Success (Code Improved)

## 1. Tóm tắt Phân tích (Summary)
So sánh **Bulk Scraper** (script anh viết) vs **API Search** (code cũ) để tìm ra lý do bulk scraper hoạt động ổn định hơn.

## 2. Key Differences Identified

| Aspect | Bulk Scraper ✅ | API Search (Old) ❌ |
|--------|----------------|---------------------|
| Navigation | Direct URL `?page=n` | Fill search form |
| Resource Blocking | Blocks images/fonts | No blocking |
| Timeout | 60s | 30s |
| Retry Logic | 3 retries | No retries |
| Browser Args | `--no-sandbox` | None |

## 3. Fixes Applied to `core_drug.py` (v4)

1. ✅ **Resource Blocking**: `await page.route("**/*", block_resources)`
2. ✅ **60s Timeout**: `page.set_default_timeout(60000)`
3. ✅ **3-Retry Logic**: For both navigation and search phases
4. ✅ **`ignore_https_errors=True`**: More robust HTTPS handling
5. ✅ **Longer wait for results**: 3s instead of 2s

## 4. Verification Results
- Script executed with retry logic working (logs: `attempt 2`, `attempt 3`)
- DAV site finished in 44s
- ThuocBietDuoc still fails input selector (site-specific issue, needs CSS inspect)

## 5. Lessons Learned (Tri thức đúc kết)
- **Direct URL pagination** beats search form for bulk scraping
- **Resource blocking** dramatically improves load time
- **Retry logic** is essential for unreliable networks
- **Higher timeouts** prevent premature failures
